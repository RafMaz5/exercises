<!DOCTYPE html>
<html><head>
<meta http-equiv='X-UA-Compatible' content='IE=edge' />
<meta charset="utf-8">
<title>Hello World</title>

<script id='sap-ui-bootstrap'
    src='sapUI/resources/sap-ui-core.js'
    data-sap-ui-theme='sap_bluecrystal'
    data-sap-ui-libs='sap.ui.commons,sap.m,sap.ui.dt'
    data-sap-ui-compatVersion='edge'
    data-sap-ui-preload='async'>

</script>
<style type="text/css">
  .center-position {
    position: absolute;
    top: 50%;
    left: 50%;
    margin-right: -50%;
    transform: translate(-50%, -50%);
  }
  #overlay {
    display: none;
    z-index: 3000;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%; 
    height: 100%;
    opacity: 0.4;
    filter: alpha(opacity=40); /* For IE8 and earlier */
    background-color: #000000;
  }
</style>
<script>

function IrideCRMPrompter(container, contactId, terminalId) {
  this.connection = new Connection (contactId, terminalId);
  this.container = container;

  this.loading = function(){
//  $('#overlay').show();
  }
  this.loadingEnd = function(){
    $('#overlay').hide();
  }
  this.textArea = new sap.m.TextArea("text-area", {placeholder: "Hello World", width: "100%"});

  this.submitButton = new sap.ui.commons.Button({
        text: "PressMe",
        press: function(){
          var value = textArea.getValue();
          var obj = {
            "type": "classify",
            "startClassificationInVO":{
                    "contactId": contactId,
                    "textMessage":value,
            }
          };
          connection.send(JSON.stringify(obj));
          loading();
        }
      });

  this.loadPrompter = function () {
    sap.ui.getCore().attachInit(function () {
      var button = sap.ui.commons.Button({});
      this.submitButton.addStyleClass("sapMSlt");
      var accordion = new sap.ui.commons.Accordion("accordion-principal", {width: "100%"})
      var section1 = new sap.ui.commons.AccordionSection("section1", {title: "Prompter"})
      var section2 = new sap.ui.commons.AccordionSection("section2", {title: "Classification Result"})
      accordion.addSection(section1);
      accordion.addSection(section2);
      section1.addContent(this.textArea);
      section1.addContent(submitButton);
      var panel = new sap.m.Panel("layout", {content:accordion});
      panel.setHeight("100%");
      panel.setBackgroundDesign(sap.m.BackgroundDesign.Transparent)
      panel.placeAt(this.container);
    });
  }

  function Connection(contactId, terminalId) {
    this.contactId = contactId;
    this.terminalId = terminalId;
    this.wsUrl = 'ws://127.0.0.1:8080/webapplication-api-crm/prompterWebSocketServer/' + this.contactId;
    if (terminalId) {
      this.wsUrl = this.wsUrl+'?terminalId=' + terminalId;
    }
    this.connection = new WebSocket(this.wsUrl);
    this.connection.onopen = function (e) {};
    this.connection.onerror = function (error) {
      console.log('WebSocket Error ' + error + "\nfor connection: " + + error.currentTarget.url);
    };
    this.connection.onclose = function () {
      console.log('WebSocket connection closed.');
    };
    // Log messages from the server
    this.connection.onmessage = function (e) {
      var message = JSON.parse(e.data);
      console.log('Server responds with: ' + e.data);
      if (message.terminalId){
        this.terminalId = message.terminalId;
        return JSON.stringify(message.terminalId);
      } else {
        return JSON.stringify(message.idTupleToLevel);
      }
    };
  }

  function StartClassificationInVO (contactId, textMessage, language, classificationLogics, notShowExtractedConcepts, notShowNeRecognized) {
    this.contactId = contactId;
    this.textMessage = textMessage;
    this.language = language;
    this.classificationLogics = classificationLogics;
    this.notShowExtractedConcepts = notShowExtractedConcepts;
    this.notShowNeRecognized = notShowNeRecognized;

    this.addClassificationLogic = function (classificationLogic) {
      if(!(this.classificationLogics)) {
        this.classificationLogics = [];
      }
      this.classificationLogics.push(classificationLogic)
    }
  }

  function Message (type, startClassificationInVO, idTupleToLevel) {
    this.type = type;
    this.startClassificationInVO = startClassificationInVO;

    this.idTupleToLevel = idTupleToLevel;
  }
}


contactId = 'pippo';
terminalId = 14920349;
container = "content";
prompter = new IrideCRMPrompter(container, contactId, terminalId);



</script>

</head>
<body class='sapUiBody'>
    <div id='content'></div>
    <div id='overlay'>
      <img src="img/ajax-loader.gif" class="center-position">
    </div>
</body>
</html>
